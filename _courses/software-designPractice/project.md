---
title: "课程大作业：mini-lisp 解释器"
layout: course
collection: courses
parent: software-designPractice
position: 1
permalink: /courses/software-designPractice/project/
---

课程大作业内容是实现一个简单lisp语言解释器，别担心！写解释器的教程相当完善！并且我们只选择支持lisp语言的一个子集。尽管是这样一个简单的解释器，它也足够用来应付OJ了，你的解释器最终可以解释快速排序、归并排序、递归、回溯等你能想到的简单算法！相关教程见：[软件设计实践](https://pku-software.github.io/)。

基本实现在课程文档里已经写得很详细了，下面主要是踩过的坑以及 `level-7 +` 的内容。

参考代码在[这里](https://github.com/SnoooowyOwl/mini-lisp),我大一的时候不太会用git，索性就把visual studio工程整个传上去了，应该可以直接运行。
## 支持代码高亮
代码高亮就是要给代码的不同部分染不同的颜色，具体的效果可以参考任何一个IDE，为了简单起见，我们不妨考虑将以下这些东西显示为特殊的颜色，其余的部分仍保持白色：数字，标识符(identifier), 保留字和函数名，括号。

可以借鉴已有的`tokenizer`结构，写一个专用于高亮的简单`toknizer`,只识别出你想要的token就可以了。

终端的行为是当你按下键盘的回车键时，将输入缓冲区里的内容全部输出(包括你最后按下的回车)，所以你在终端里能看到按下回车后它换行了。为了支持实时的代码高亮，就需要不断地将输出缓冲区的内容输出，也需要不断刷新终端显示的内容。假设用户输入了一个新的字符，首先需要使用退格`\b`和空白字符将终端上已有的旧内容“抹掉”，然后将缓冲区的内容输出。

但是 当你按下回车的时候，你并不是向输入缓冲区里放了一个`'\n'`字符，而是`'\n'`和`'\r'`两个，windows用`\r\n`表示换行，mac用`\n\r`表示换行。

以上这种方法优点是实现简单，缺点是闪烁感强，每新输入一个字符就要刷新一遍，而且处理跨行输入不方便。更高级的方法可以使用终端UI库甚至GUI，这里不赘述。

## 支持跨行输入

记录换行符的位置
## 支持更多的函数
字符串操作等等

## 关于最终的面测
助教会拿一些刁钻的测试用例检查你的程序。只要你的程序没有中途崩掉，都不算太大的错误。我面测的时候遇到了两个问题：

- 没有区分**对子** 和 **列表**，去翻翻语言标准手册，可以发现对子的最右边元素必须是一个空串，它才成为一个列表！列表和对子的字符串表示是不一样的(元素之间有没有点的区别)，你的解释器不能把对子变成只有两个元素的列表，更不能把列表变成对子。

- 转义字符处理错误，特别注意程序里哪些地方要使用**原始字符串**(RAW string),用`sstream`处理。

---